name: AutoTest

on:
  workflow_dispatch:  # manually trigger
  workflow_call:
jobs:
  #Windows X86_64
  win64_x86_64_testMSVC_cpp14:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Build for Windows
        run: |
          cd build\test\win64  
          .\run_test_msvc.bat 14
  

  win64_x86_64_testMSVC_Clang_cpp14:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Build for Windows
        run: |
          cd build\test\win64  
          .\run_test_clang.bat 14

  win64_x86_64_testMinGW_GCC_cpp14:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'



      - name: Install MSYS2
        uses: msys2/setup-msys2@v2
        id: msys2
        with:
          msystem: MINGW64
          release: true
          path-type: inherit
          install: mingw-w64-x86_64-gcc mingw-w64-x86_64-binutils mingw-w64-x86_64-make
          update: true

      - name: Ensure MSYS2 packages
        shell: msys2 {0}
        run: |
          pacman -S --noconfirm --needed --overwrite '*' mingw-w64-x86_64-gcc mingw-w64-x86_64-binutils mingw-w64-x86_64-make
          echo "MSYS2 Root: $MSYSTEM_CARCH"
          which gcc
          which mingw32-make
      - name: Remove conflicting MinGW paths
        run: |
          $env:Path = $env:Path -replace 'C:\\mingw64\\bin;','' -replace 'C:\\Program Files\\Git\\mingw64\\bin;',''
          echo "PATH=$env:Path" >> $env:GITHUB_ENV
        shell: powershell
      - name: Add MSYS2 to PATH
        run: |
          $env:Path = "${{ steps.msys2.outputs.msys2-location }}\mingw64\bin;" + $env:Path
          echo "PATH=$env:Path" >> $env:GITHUB_ENV
        shell: powershell

      - name: Build for Windows
        run: |
          cd build\test\win64  
          .\run_test_MinGW_GCC.bat 14
  

  win64_x86_64_testMinGW_Clang_cpp14:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Build for Windows
        run: |
          cd build\test\win64  
          .\run_test_MinGW_Clang.bat 14

  win64_x86_64_testMSVC_cpp17:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Build for Windows
        run: |
          cd build\test\win64  
          .\run_test_msvc.bat 17
  

  win64_x86_64_testMSVC_Clang_cpp17:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Build for Windows
        run: |
          cd build\test\win64  
          .\run_test_clang.bat 17

  win64_x86_64_testMinGW_GCC_cpp17:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'



      - name: Install MSYS2
        uses: msys2/setup-msys2@v2
        id: msys2
        with:
          msystem: MINGW64
          release: true
          path-type: inherit
          install: mingw-w64-x86_64-gcc mingw-w64-x86_64-binutils mingw-w64-x86_64-make
          update: true

      - name: Ensure MSYS2 packages
        shell: msys2 {0}
        run: |
          pacman -S --noconfirm --needed --overwrite '*' mingw-w64-x86_64-gcc mingw-w64-x86_64-binutils mingw-w64-x86_64-make
          echo "MSYS2 Root: $MSYSTEM_CARCH"
          which gcc
          which mingw32-make
      - name: Remove conflicting MinGW paths
        run: |
          $env:Path = $env:Path -replace 'C:\\mingw64\\bin;','' -replace 'C:\\Program Files\\Git\\mingw64\\bin;',''
          echo "PATH=$env:Path" >> $env:GITHUB_ENV
        shell: powershell
      - name: Add MSYS2 to PATH
        run: |
          $env:Path = "${{ steps.msys2.outputs.msys2-location }}\mingw64\bin;" + $env:Path
          echo "PATH=$env:Path" >> $env:GITHUB_ENV
        shell: powershell

      - name: Build for Windows
        run: |
          cd build\test\win64  
          .\run_test_MinGW_GCC.bat 17
  

  win64_x86_64_testMinGW_Clang_cpp17:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Build for Windows
        run: |
          cd build\test\win64  
          .\run_test_MinGW_Clang.bat 17

  win64_x86_64_testMSVC_cpp20:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Build for Windows
        run: |
          cd build\test\win64  
          .\run_test_msvc.bat 20

  win64_x86_64_testMSVC_Clang_cpp20:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Build for Windows
        run: |
          cd build\test\win64  
          .\run_test_clang.bat 20

  win64_x86_64_testMinGW_GCC_cpp20:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install MSYS2
        uses: msys2/setup-msys2@v2
        id: msys2
        with:
          msystem: MINGW64
          release: true
          path-type: inherit
          install: mingw-w64-x86_64-gcc mingw-w64-x86_64-binutils mingw-w64-x86_64-make
          update: true

      - name: Ensure MSYS2 packages
        shell: msys2 {0}
        run: |
          pacman -S --noconfirm --needed --overwrite '*' mingw-w64-x86_64-gcc mingw-w64-x86_64-binutils mingw-w64-x86_64-make
          echo "MSYS2 Root: $MSYSTEM_CARCH"
          which gcc
          which mingw32-make
      - name: Remove conflicting MinGW paths
        run: |
          $env:Path = $env:Path -replace 'C:\\mingw64\\bin;','' -replace 'C:\\Program Files\\Git\\mingw64\\bin;',''
          echo "PATH=$env:Path" >> $env:GITHUB_ENV
        shell: powershell
      - name: Add MSYS2 to PATH
        run: |
          $env:Path = "${{ steps.msys2.outputs.msys2-location }}\mingw64\bin;" + $env:Path
          echo "PATH=$env:Path" >> $env:GITHUB_ENV
        shell: powershell

      - name: Build for Windows
        run: |
          cd build\test\win64  
          .\run_test_MinGW_GCC.bat 20

  win64_x86_64_testMinGW_Clang_cpp20:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Build for Windows
        run: |
          cd build\test\win64  
          .\run_test_MinGW_Clang.bat 20

  win64_x86_64_testMSVC_cpp23:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Build for Windows
        run: |
          cd build\test\win64  
          .\run_test_msvc.bat 23
  

  win64_x86_64_testMSVC_Clang_cpp23:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Build for Windows
        run: |
          cd build\test\win64  
          .\run_test_clang.bat 23

  win64_x86_64_testMinGW_GCC_cpp23:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install MSYS2
        uses: msys2/setup-msys2@v2
        id: msys2
        with:
          msystem: MINGW64
          release: true
          path-type: inherit
          install: mingw-w64-x86_64-gcc mingw-w64-x86_64-binutils mingw-w64-x86_64-make
          update: true

      - name: Ensure MSYS2 packages
        shell: msys2 {0}
        run: |
          pacman -S --noconfirm --needed --overwrite '*' mingw-w64-x86_64-gcc mingw-w64-x86_64-binutils mingw-w64-x86_64-make
          echo "MSYS2 Root: $MSYSTEM_CARCH"
          which gcc
          which mingw32-make
      - name: Remove conflicting MinGW paths
        run: |
          $env:Path = $env:Path -replace 'C:\\mingw64\\bin;','' -replace 'C:\\Program Files\\Git\\mingw64\\bin;',''
          echo "PATH=$env:Path" >> $env:GITHUB_ENV
        shell: powershell
      - name: Add MSYS2 to PATH
        run: |
          $env:Path = "${{ steps.msys2.outputs.msys2-location }}\mingw64\bin;" + $env:Path
          echo "PATH=$env:Path" >> $env:GITHUB_ENV
        shell: powershell

      - name: Build for Windows
        run: |
          cd build\test\win64  
          .\run_test_MinGW_GCC.bat 23
  

  win64_x86_64_testMinGW_Clang_cpp23:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Build for Windows
        run: |
          cd build\test\win64  
          .\run_test_MinGW_Clang.bat 23      

  #Windows ARM64
  win_arm64_test_MinGW_Clang_cpp14:
    runs-on: windows-11-arm
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Clang
        run: |
          choco uninstall -y llvm --all-versions
          choco install -y llvm
        shell: powershell

      - name: Build for Windows
        run: |
          cd build\test\win64  
          mkdir build_folder
          cd build_folder
          cmake ..\..\..\..\test -G "MinGW Makefiles" -DTARGET_PLATFORM:STRING=win64 -DCPP_VER=14 -DCMAKE_BUILD_TYPE=Debug -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++
          make
          objdump -f BqLogUnitTest.exe
          .\BqLogUnitTest.exe
          cmake ..\..\..\..\test -G "MinGW Makefiles" -DTARGET_PLATFORM:STRING=win64 -DCPP_VER=14 -DCMAKE_BUILD_TYPE=RelWithDebInfo -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++
          make -j4
          .\BqLogUnitTest.exe

  win_arm64_test_MinGW_Clang_cpp17:
    runs-on: windows-11-arm
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Clang
        run: |
          choco uninstall -y llvm --all-versions
          choco install -y llvm
        shell: powershell

      - name: Build for Windows
        run: |
          cd build\test\win64  
          mkdir build_folder
          cd build_folder
          cmake ..\..\..\..\test -G "MinGW Makefiles" -DTARGET_PLATFORM:STRING=win64 -DCPP_VER=17 -DCMAKE_BUILD_TYPE=Debug -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++
          make
          objdump -f BqLogUnitTest.exe
          .\BqLogUnitTest.exe
          cmake ..\..\..\..\test -G "MinGW Makefiles" -DTARGET_PLATFORM:STRING=win64 -DCPP_VER=17 -DCMAKE_BUILD_TYPE=RelWithDebInfo -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++
          make -j4
          .\BqLogUnitTest.exe

  win_arm64_test_MinGW_Clang_cpp20:
    runs-on: windows-11-arm
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Clang
        run: |
          choco uninstall -y llvm --all-versions
          choco install -y llvm
        shell: powershell

      - name: Build for Windows
        run: |
          cd build\test\win64  
          mkdir build_folder
          cd build_folder
          cmake ..\..\..\..\test -G "MinGW Makefiles" -DTARGET_PLATFORM:STRING=win64 -DCPP_VER=20 -DCMAKE_BUILD_TYPE=Debug -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++
          make
          objdump -f BqLogUnitTest.exe
          .\BqLogUnitTest.exe
          cmake ..\..\..\..\test -G "MinGW Makefiles" -DTARGET_PLATFORM:STRING=win64 -DCPP_VER=20 -DCMAKE_BUILD_TYPE=RelWithDebInfo -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++
          make -j4
          .\BqLogUnitTest.exe


  #Linux-ubuntu-X86_64
  ubuntu_x86_64_testGCC_cpp11:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install GDB
        run: |
          sudo apt-get update
          sudo apt-get install -y gdb

      - name: Build for Linux
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 11
  
  ubuntu_x86_64_testClang_cpp11:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install GDB
        run: |
          sudo apt-get update
          sudo apt-get install -y gdb

      - name: Build for Linux
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 11

  ubuntu_x86_64_testGCC_cpp14:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install GDB
        run: |
          sudo apt-get update
          sudo apt-get install -y gdb

      - name: Build for Linux
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 14

  ubuntu_x86_64_testClang_cpp14:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install GDB
        run: |
          sudo apt-get update
          sudo apt-get install -y gdb

      - name: Build for Linux
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 14

  ubuntu_x86_64_testGCC_cpp17:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install GDB
        run: |
          sudo apt-get update
          sudo apt-get install -y gdb

      - name: Build for Linux
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 17

  ubuntu_x86_64_testClang_cpp17:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install GDB
        run: |
          sudo apt-get update
          sudo apt-get install -y gdb

      - name: Build for Linux
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 17

  ubuntu_x86_64_testGCC_cpp20:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install GDB
        run: |
          sudo apt-get update
          sudo apt-get install -y gdb

      - name: Build for Linux
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 20

  ubuntu_x86_64_testClang_cpp20:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install GDB
        run: |
          sudo apt-get update
          sudo apt-get install -y gdb

      - name: Build for Linux
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 20

  ubuntu_x86_64_testGCC_cpp23:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install GDB
        run: |
          sudo apt-get update
          sudo apt-get install -y gdb

      - name: Build for Linux
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 23

  ubuntu_x86_64_testClang_cpp23:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install GDB
        run: |
          sudo apt-get update
          sudo apt-get install -y gdb

      - name: Build for Linux
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 23

  #Linux-ubuntu-ARM64
  ubuntu_arm64_test_GCC_cpp11:
    runs-on: ubuntu-24.04-arm
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install GDB
        run: |
          sudo apt-get update
          sudo apt-get install -y gdb

      - name: Build for Linux
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 11

  ubuntu_arm64_test_Clang_cpp11:
    runs-on: ubuntu-24.04-arm
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install GDB
        run: |
          sudo apt-get update
          sudo apt-get install -y gdb

      - name: Build for Linux
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 11

  ubuntu_arm64_test_GCC_cpp14:
    runs-on: ubuntu-24.04-arm
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install GDB
        run: |
          sudo apt-get update
          sudo apt-get install -y gdb

      - name: Build for Linux
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 14

  ubuntu_arm64_test_Clang_cpp14:
    runs-on: ubuntu-24.04-arm
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install GDB
        run: |
          sudo apt-get update
          sudo apt-get install -y gdb

      - name: Build for Linux
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 14

  ubuntu_arm64_test_GCC_cpp17:
    runs-on: ubuntu-24.04-arm
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install GDB
        run: |
          sudo apt-get update
          sudo apt-get install -y gdb

      - name: Build for Linux
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 17

  ubuntu_arm64_test_Clang_cpp17:
    runs-on: ubuntu-24.04-arm
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install GDB
        run: |
          sudo apt-get update
          sudo apt-get install -y gdb

      - name: Build for Linux
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 17

  ubuntu_arm64_test_GCC_cpp20:
    runs-on: ubuntu-24.04-arm
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install GDB
        run: |
          sudo apt-get update
          sudo apt-get install -y gdb

      - name: Build for Linux
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 20

  ubuntu_arm64_test_Clang_cpp20:
    runs-on: ubuntu-24.04-arm
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install GDB
        run: |
          sudo apt-get update
          sudo apt-get install -y gdb

      - name: Build for Linux
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 20

  ubuntu_arm64_test_GCC_cpp23:
    runs-on: ubuntu-24.04-arm
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install GDB
        run: |
          sudo apt-get update
          sudo apt-get install -y gdb

      - name: Build for Linux
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 23

  ubuntu_arm64_test_Clang_cpp23:
    runs-on: ubuntu-24.04-arm
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Install GDB
        run: |
          sudo apt-get update
          sudo apt-get install -y gdb

      - name: Build for Linux
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 23

  #linux-debian
  debian_x86_64_test_GCC_cpp17:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/pippocao/bqlog/debian:latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install necessary tools (gcc and clang)
        run: |
          apt-get update
          apt-get install -y gcc clang g++ make cmake gdb

          apt-get install -y software-properties-common
          apt-get update
          apt-get install -y openjdk-17-jdk
          apt-get install -y openssh-client

      - name: Set up Java
        run: |
          export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
          echo "JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64" >> $GITHUB_ENV

      - name: Build for Debian
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 
  
  debian_x86_64_test_Clang_cpp17:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/pippocao/bqlog/debian:latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install necessary tools (gcc and clang)
        run: |
          apt-get update
          apt-get install -y gcc clang g++ make cmake gdb

          apt-get install -y software-properties-common
          apt-get update
          apt-get install -y openjdk-17-jdk
          apt-get install -y openssh-client

      - name: Set up Java
        run: |
          export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
          echo "JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64" >> $GITHUB_ENV

      - name: Build for Debian
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 

  debian_x86_test_GCC_cpp17:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/pippocao/bqlog/i386_debian:latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install necessary tools (gcc and clang)
        run: |
          apt-get update
          apt-get install -y gcc clang g++ make cmake gdb

          apt-get install -y software-properties-common
          apt-get update
          apt-get install -y openjdk-17-jdk
          apt-get install -y openssh-client

      - name: Set up Java
        run: |
          export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-i386
          echo "JAVA_HOME=/usr/lib/jvm/java-17-openjdk-i386" >> $GITHUB_ENV

      - name: Build for Debian 32
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 

  debian_x86_test_Clang_cpp17:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/pippocao/bqlog/i386_debian:latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install necessary tools (gcc and clang)
        run: |
          apt-get update
          apt-get install -y gcc clang g++ make cmake gdb

          apt-get install -y software-properties-common
          apt-get update
          apt-get install -y openjdk-17-jdk
          apt-get install -y openssh-client

      - name: Set up Java
        run: |
          export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-i386
          echo "JAVA_HOME=/usr/lib/jvm/java-17-openjdk-i386" >> $GITHUB_ENV

      - name: Build for Debian 32
        run: |
          cd build/test/linux  
          chmod +x *.sh
          ./run_test_clang.sh 

  #Mac
  mac_apple_silicon_test_cpp11:
    runs-on: macos-latest
    steps:
      - uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: latest-stable

      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Build for macOS
        run: |
          cd build/test/mac  
          chmod +x *.sh
          ./run_test.sh 11

  mac_apple_silicon_test_cpp14:
    runs-on: macos-latest
    steps:
      - uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: latest-stable

      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Build for macOS
        run: |
          cd build/test/mac  
          chmod +x *.sh
          ./run_test.sh 14

  mac_apple_silicon_test_cpp17:
    runs-on: macos-latest
    steps:
      - uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: latest-stable

      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Build for macOS
        run: |
          cd build/test/mac  
          chmod +x *.sh
          ./run_test.sh 17

  mac_apple_silicon_test_cpp20:
    runs-on: macos-latest
    steps:
      - uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: latest-stable

      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Build for macOS
        run: |
          cd build/test/mac  
          chmod +x *.sh
          ./run_test.sh 20

  mac_apple_silicon_test_cpp23:
    runs-on: macos-latest
    steps:
      - uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: latest-stable

      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Build for macOS
        run: |
          cd build/test/mac  
          chmod +x *.sh
          ./run_test.sh 23

  #Unix-FreeBSD
  freeBSD_x86_64_test_Clang_cpp11:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in FreeBSD
        id: RunInFreeBSD
        uses: vmactions/freebsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg install -y llvm cmake bash gdb gcc

          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 11

  freeBSD_x86_64_test_GCC_cpp11:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in FreeBSD
        id: RunInFreeBSD
        uses: vmactions/freebsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg install -y llvm cmake bash gdb gcc

          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 11
            
  freeBSD_x86_64_test_Clang_cpp17:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in FreeBSD
        id: RunInFreeBSD
        uses: vmactions/freebsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg install -y llvm cmake bash gdb gcc

          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 17

  freeBSD_x86_64_test_GCC_cpp17:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in FreeBSD
        id: RunInFreeBSD
        uses: vmactions/freebsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg install -y llvm cmake bash gdb gcc

          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 17
            
  freeBSD_x86_64_test_Clang_cpp20:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in FreeBSD
        id: RunInFreeBSD
        uses: vmactions/freebsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg install -y llvm cmake bash gdb gcc

          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 20

  freeBSD_x86_64_test_GCC_cpp20:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in FreeBSD
        id: RunInFreeBSD
        uses: vmactions/freebsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg install -y llvm cmake bash gdb gcc

          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 20
            
  freeBSD_x86_64_test_Clang_cpp23:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in FreeBSD
        id: RunInFreeBSD
        uses: vmactions/freebsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg install -y llvm cmake bash gdb gcc

          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 23

  freeBSD_x86_64_test_GCC_cpp23:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in FreeBSD
        id: RunInFreeBSD
        uses: vmactions/freebsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg install -y llvm cmake bash gdb gcc

          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 23
  
  freeBSD_arm64_test_Clang_cpp17:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in FreeBSD
        id: RunInFreeBSD
        uses: vmactions/freebsd-vm@v1
        with:
          arch: aarch64
          usesh: true
          mem: 8192
          prepare: |
            pkg install -y llvm cmake bash gdb gcc

          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 17

  freeBSD_arm64_test_GCC_cpp17:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in FreeBSD
        id: RunInFreeBSD
        uses: vmactions/freebsd-vm@v1
        with:
          arch: aarch64
          usesh: true
          mem: 8192
          prepare: |
            pkg install -y llvm cmake bash gdb gcc13

          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ln -sf /usr/local/bin/gcc13 /usr/local/bin/gcc
            ln -sf /usr/local/bin/g++13 /usr/local/bin/g++
            ln -sf /usr/local/bin/gcov13 /usr/local/bin/gcov 2>/dev/null || true
            ln -sf /usr/local/bin/gcc-ar13 /usr/local/bin/gcc-ar 2>/dev/null || true
            ln -sf /usr/local/bin/gcc-ranlib13 /usr/local/bin/gcc-ranlib 2>/dev/null || true
            export LD_LIBRARY_PATH=/usr/local/lib/gcc13  #Adjust according to installed GCC version
            ./run_test_gcc.sh 17
  

  #Unix-Solaris
  Solaris_x86_64_test_GCC_cpp11:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in Solaris
        id: RunInSolaris
        uses: vmactions/solaris-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg publisher
            pkg install -v --accept \
              developer/build/cmake \
              developer/build/gnu-make \
              developer/debug/gdb \
              developer/gcc-14 \
              shell/bash
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 11 

  Solaris_x86_64_test_GCC_cpp14:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in Solaris
        id: RunInSolaris
        uses: vmactions/solaris-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg publisher
            pkg install -v --accept \
              developer/build/cmake \
              developer/build/gnu-make \
              developer/debug/gdb \
              developer/gcc-14 \
              shell/bash
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 14

  Solaris_x86_64_test_GCC_cpp17:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in Solaris
        id: RunInSolaris
        uses: vmactions/solaris-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg publisher
            pkg install -v --accept \
              developer/build/cmake \
              developer/build/gnu-make \
              developer/debug/gdb \
              developer/gcc-14 \
              shell/bash
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 17

  Solaris_x86_64_test_GCC_cpp20:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in Solaris
        id: RunInSolaris
        uses: vmactions/solaris-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg publisher
            pkg install -v --accept \
              developer/build/cmake \
              developer/build/gnu-make \
              developer/debug/gdb \
              developer/gcc-14 \
              shell/bash
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 20

  Solaris_x86_64_test_GCC_cpp23:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in Solaris
        id: RunInSolaris
        uses: vmactions/solaris-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg publisher
            pkg install -v --accept \
              developer/build/cmake \
              developer/build/gnu-make \
              developer/debug/gdb \
              developer/gcc-14 \
              shell/bash
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 23 

  #Unix-OmnisOS
  OmnisOS_x86_64_test_GCC_cpp11:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in OmnisOS
        id: RunInOmnisOS
        uses: vmactions/omnios-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            set -e
            pkg refresh --full
            if ! pkg publisher | grep -q '^extra\.omnios'; then
              REL="$(uname -v | sed -n 's/.*\(r[0-9][0-9]*\).*/\1/p')"
              [ -n "$REL" ] || REL="r151054"
              pkg set-publisher -g "https://pkg.omnios.org/${REL}/extra" extra.omnios || true
              pkg refresh --full
            fi
            
            pkg install -v --accept shell/bash developer/build/gnu-make || true
            pkg install -v --accept ooce/developer/cmake
            pkg install -v --accept developer/gcc13
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 11 

  OmnisOS_x86_64_test_GCC_cpp14:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in OmnisOS
        id: RunInOmnisOS
        uses: vmactions/omnios-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            set -e
            pkg refresh --full
            if ! pkg publisher | grep -q '^extra\.omnios'; then
              REL="$(uname -v | sed -n 's/.*\(r[0-9][0-9]*\).*/\1/p')"
              [ -n "$REL" ] || REL="r151054"
              pkg set-publisher -g "https://pkg.omnios.org/${REL}/extra" extra.omnios || true
              pkg refresh --full
            fi
            
            pkg install -v --accept shell/bash developer/build/gnu-make || true
            pkg install -v --accept ooce/developer/cmake
            pkg install -v --accept developer/gcc13
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 14 

  OmnisOS_x86_64_test_GCC_cpp17:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in OmnisOS
        id: RunInOmnisOS
        uses: vmactions/omnios-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            set -e
            pkg refresh --full
            if ! pkg publisher | grep -q '^extra\.omnios'; then
              REL="$(uname -v | sed -n 's/.*\(r[0-9][0-9]*\).*/\1/p')"
              [ -n "$REL" ] || REL="r151054"
              pkg set-publisher -g "https://pkg.omnios.org/${REL}/extra" extra.omnios || true
              pkg refresh --full
            fi
            
            pkg install -v --accept shell/bash developer/build/gnu-make || true
            pkg install -v --accept ooce/developer/cmake
            pkg install -v --accept developer/gcc13
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 17 

  OmnisOS_x86_64_test_GCC_cpp20:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in OmnisOS
        id: RunInOmnisOS
        uses: vmactions/omnios-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            set -e
            pkg refresh --full
            if ! pkg publisher | grep -q '^extra\.omnios'; then
              REL="$(uname -v | sed -n 's/.*\(r[0-9][0-9]*\).*/\1/p')"
              [ -n "$REL" ] || REL="r151054"
              pkg set-publisher -g "https://pkg.omnios.org/${REL}/extra" extra.omnios || true
              pkg refresh --full
            fi
            
            pkg install -v --accept shell/bash developer/build/gnu-make || true
            pkg install -v --accept ooce/developer/cmake
            pkg install -v --accept developer/gcc13
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 20 
            
  OmnisOS_x86_64_test_GCC_cpp23:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in OmnisOS
        id: RunInOmnisOS
        uses: vmactions/omnios-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            set -e
            pkg refresh --full
            if ! pkg publisher | grep -q '^extra\.omnios'; then
              REL="$(uname -v | sed -n 's/.*\(r[0-9][0-9]*\).*/\1/p')"
              [ -n "$REL" ] || REL="r151054"
              pkg set-publisher -g "https://pkg.omnios.org/${REL}/extra" extra.omnios || true
              pkg refresh --full
            fi
            
            pkg install -v --accept shell/bash developer/build/gnu-make || true
            pkg install -v --accept ooce/developer/cmake
            pkg install -v --accept developer/gcc13
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 23 

  #Unix-DragonFlyBSD
  DragonFlyBSD_x86_64_test_Clang_cpp11:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in DragonFlyBSD
        id: DragonFlyBSD
        uses: vmactions/dragonflybsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg install -y cmake bash gmake gdb openjdk11 gcc llvm
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 11 

  DragonFlyBSD_x86_64_test_GCC_cpp11:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in DragonFlyBSD
        id: DragonFlyBSD
        uses: vmactions/dragonflybsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg install -y cmake bash gmake gdb openjdk11 gcc llvm
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 11 

  DragonFlyBSD_x86_64_test_Clang_cpp14:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in DragonFlyBSD
        id: DragonFlyBSD
        uses: vmactions/dragonflybsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg install -y cmake bash gmake gdb openjdk11 gcc llvm
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 14

  DragonFlyBSD_x86_64_test_GCC_cpp14:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in DragonFlyBSD
        id: DragonFlyBSD
        uses: vmactions/dragonflybsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg install -y cmake bash gmake gdb openjdk11 gcc llvm
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 14

  DragonFlyBSD_x86_64_test_Clang_cpp17:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in DragonFlyBSD
        id: DragonFlyBSD
        uses: vmactions/dragonflybsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg install -y cmake bash gmake gdb openjdk11 gcc llvm
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 17

  DragonFlyBSD_x86_64_test_GCC_cpp17:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in DragonFlyBSD
        id: DragonFlyBSD
        uses: vmactions/dragonflybsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg install -y cmake bash gmake gdb openjdk11 gcc llvm
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 17 

  DragonFlyBSD_x86_64_test_Clang_cpp20:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in DragonFlyBSD
        id: DragonFlyBSD
        uses: vmactions/dragonflybsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg install -y cmake bash gmake gdb openjdk11 gcc llvm
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 20

  DragonFlyBSD_x86_64_test_GCC_cpp20:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in DragonFlyBSD
        id: DragonFlyBSD
        uses: vmactions/dragonflybsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg install -y cmake bash gmake gdb openjdk11 gcc llvm
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 20

  DragonFlyBSD_x86_64_test_Clang_cpp23:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in DragonFlyBSD
        id: DragonFlyBSD
        uses: vmactions/dragonflybsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg install -y cmake bash gmake gdb openjdk11 gcc llvm
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 23
            
  #Unix-OpenBSD
  OpenBSD_x86_64_test_Clang_cpp11:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in OpenBSD
        id: OpenBSD
        uses: vmactions/openbsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg_add cmake bash gdb
          run: |
            set -e -x

            # 启用 core dump：文件名 core.<pid>
            sysctl kern.defcorename=core.%pid || true
            sysctl kern.defcorename
            ulimit -c unlimited || true
            ulimit -a | grep 'core file'

            cd build/test/unix_like
            chmod +x *.sh
            ls -l

            # 不让 set -e 直接终止，手动处理退出码
            set +e
            ./run_test_clang.sh 11
            EXIT_CODE=$?
            set -e
            echo "run_test_clang.sh exit code: $EXIT_CODE"

            if [ $EXIT_CODE -ne 0 ]; then
              echo "Test failed, searching for core files..."
              # 取第一个 core / core.*
              CORE_FILE=""
              for f in core core.*; do
                if [ -f "$f" ]; then
                  CORE_FILE="$f"
                  break
                fi
              done

              if [ -n "$CORE_FILE" ]; then
                echo "Found core file: $CORE_FILE"
                if command -v gdb >/dev/null 2>&1; then
                  echo "=== GDB core backtrace ==="
                  gdb --batch -q \
                      -ex "set pagination off" \
                      -ex "info threads" \
                      -ex "thread apply all bt full" \
                      -ex "quit" \
                      ./CMakeFiles/BqLogUnitTest.dir/* >/dev/null 2>&1 && echo "NOTE: object dir scanned" || true
                  # 主二进制通常在当前目录
                  if [ -f ./BqLogUnitTest ]; then
                    gdb --batch -q \
                        -ex "set pagination off" \
                        -ex "info threads" \
                        -ex "thread apply all bt full" \
                        -ex "quit" \
                        ./BqLogUnitTest "$CORE_FILE" || echo "gdb core analysis failed"
                  else
                    echo "Executable BqLogUnitTest not found (adjust path if needed)."
                  fi
                else
                  echo "gdb not installed? (should have been)."
                fi
              else
                echo "No core file produced. Running once under gdb for live stack..."
                if command -v gdb >/dev/null 2>&1 && [ -f ./BqLogUnitTest ]; then
                  gdb --batch -q \
                      -ex "set pagination off" \
                      -ex "run" \
                      -ex "info threads" \
                      -ex "thread apply all bt full" \
                      -ex "quit" \
                      ./BqLogUnitTest || true
                fi
              fi
              exit $EXIT_CODE
            else
              echo "Test succeeded."
            fi

  OpenBSD_x86_64_test_Clang_cpp14:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in OpenBSD
        id: OpenBSD
        uses: vmactions/openbsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg_add  cmake bash
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 14

  OpenBSD_x86_64_test_Clang_cpp17:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in OpenBSD
        id: OpenBSD
        uses: vmactions/openbsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg_add  cmake bash
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 17

  OpenBSD_x86_64_test_Clang_cpp20:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in OpenBSD
        id: OpenBSD
        uses: vmactions/openbsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg_add  cmake bash
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 20

  OpenBSD_x86_64_test_Clang_cpp23:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in OpenBSD
        id: OpenBSD
        uses: vmactions/openbsd-vm@v1
        with:
          usesh: true
          mem: 8192
          prepare: |
            pkg_add  cmake bash
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 23

  OpenBSD_arm64_test_Clang_cpp11:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in OpenBSD
        id: OpenBSD
        uses: vmactions/openbsd-vm@v1
        with:
          arch: aarch64
          usesh: true
          mem: 8192
          prepare: |
            pkg_add  cmake bash
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 11

  OpenBSD_arm64_test_Clang_cpp14:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in OpenBSD
        id: OpenBSD
        uses: vmactions/openbsd-vm@v1
        with:
          arch: aarch64
          usesh: true
          mem: 8192
          prepare: |
            pkg_add  cmake bash
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 14

  OpenBSD_arm64_test_Clang_cpp17:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in OpenBSD
        id: OpenBSD
        uses: vmactions/openbsd-vm@v1
        with:
          arch: aarch64
          usesh: true
          mem: 8192
          prepare: |
            pkg_add  cmake bash
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 17

  OpenBSD_arm64_test_Clang_cpp20:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in OpenBSD
        id: OpenBSD
        uses: vmactions/openbsd-vm@v1
        with:
          arch: aarch64
          usesh: true
          mem: 8192
          prepare: |
            pkg_add  cmake bash
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 20

  OpenBSD_arm64_test_Clang_cpp23:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in OpenBSD
        id: OpenBSD
        uses: vmactions/openbsd-vm@v1
        with:
          arch: aarch64
          usesh: true
          mem: 8192
          prepare: |
            pkg_add  cmake bash
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 23

  #Unix-NetBSD
  NetBSD_x86_64_test_GCC_cpp11:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in NetBSD
        id: RunInNetBSD
        uses: vmactions/netbsd-vm@v1
        with:
          usesh: true
          mem: 8192
          release: "10.1"
          prepare: |
            set -e
            export PATH="/usr/sbin:/usr/bin:/usr/pkg/sbin:/usr/pkg/bin:$PATH"

            /usr/sbin/pkg_add -v pkgin || true
            pkgin -y update || true
            pkgin -y install cmake gmake bash gdb || true
            pkgin -y install clang || true
            pkgin -y install gcc12 || pkgin -y install gcc13 || pkgin -y install gcc10 || true
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 11

  NetBSD_x86_64_test_Clang_cpp11:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in NetBSD
        id: RunInNetBSD
        uses: vmactions/netbsd-vm@v1
        with:
          usesh: true
          mem: 8192
          release: "10.1"
          prepare: |
            set -e
            export PATH="/usr/sbin:/usr/bin:/usr/pkg/sbin:/usr/pkg/bin:$PATH"

            /usr/sbin/pkg_add -v pkgin || true
            pkgin -y update || true
            pkgin -y install cmake gmake bash gdb || true
            pkgin -y install clang || true
            pkgin -y install gcc12 || pkgin -y install gcc13 || pkgin -y install gcc10 || true
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 11

  NetBSD_x86_64_test_GCC_cpp14:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in NetBSD
        id: RunInNetBSD
        uses: vmactions/netbsd-vm@v1
        with:
          usesh: true
          mem: 8192
          release: "10.1"
          prepare: |
            set -e
            export PATH="/usr/sbin:/usr/bin:/usr/pkg/sbin:/usr/pkg/bin:$PATH"

            /usr/sbin/pkg_add -v pkgin || true
            pkgin -y update || true
            pkgin -y install cmake gmake bash gdb || true
            pkgin -y install clang || true
            pkgin -y install gcc12 || pkgin -y install gcc13 || pkgin -y install gcc10 || true
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 14

  NetBSD_x86_64_test_Clang_cpp14:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in NetBSD
        id: RunInNetBSD
        uses: vmactions/netbsd-vm@v1
        with:
          usesh: true
          mem: 8192
          release: "10.1"
          prepare: |
            set -e
            export PATH="/usr/sbin:/usr/bin:/usr/pkg/sbin:/usr/pkg/bin:$PATH"

            /usr/sbin/pkg_add -v pkgin || true
            pkgin -y update || true
            pkgin -y install cmake gmake bash gdb || true
            pkgin -y install clang || true
            pkgin -y install gcc12 || pkgin -y install gcc13 || pkgin -y install gcc10 || true
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 14

  NetBSD_x86_64_test_GCC_cpp17:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in NetBSD
        id: RunInNetBSD
        uses: vmactions/netbsd-vm@v1
        with:
          usesh: true
          mem: 8192
          release: "10.1"
          prepare: |
            set -e
            export PATH="/usr/sbin:/usr/bin:/usr/pkg/sbin:/usr/pkg/bin:$PATH"

            /usr/sbin/pkg_add -v pkgin || true
            pkgin -y update || true
            pkgin -y install cmake gmake bash gdb || true
            pkgin -y install clang || true
            pkgin -y install gcc12 || pkgin -y install gcc13 || pkgin -y install gcc10 || true
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 17

  NetBSD_x86_64_test_Clang_cpp17:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in NetBSD
        id: RunInNetBSD
        uses: vmactions/netbsd-vm@v1
        with:
          usesh: true
          mem: 8192
          release: "10.1"
          prepare: |
            set -e
            export PATH="/usr/sbin:/usr/bin:/usr/pkg/sbin:/usr/pkg/bin:$PATH"

            /usr/sbin/pkg_add -v pkgin || true
            pkgin -y update || true
            pkgin -y install cmake gmake bash gdb || true
            pkgin -y install clang || true
            pkgin -y install gcc12 || pkgin -y install gcc13 || pkgin -y install gcc10 || true
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 17

  NetBSD_x86_64_test_GCC_cpp20:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in NetBSD
        id: RunInNetBSD
        uses: vmactions/netbsd-vm@v1
        with:
          usesh: true
          mem: 8192
          release: "10.1"
          prepare: |
            set -e
            export PATH="/usr/sbin:/usr/bin:/usr/pkg/sbin:/usr/pkg/bin:$PATH"

            /usr/sbin/pkg_add -v pkgin || true
            pkgin -y update || true
            pkgin -y install cmake gmake bash gdb || true
            pkgin -y install clang || true
            pkgin -y install gcc12 || pkgin -y install gcc13 || pkgin -y install gcc10 || true
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_gcc.sh 20

  NetBSD_x86_64_test_Clang_cpp20:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in NetBSD
        id: RunInNetBSD
        uses: vmactions/netbsd-vm@v1
        with:
          usesh: true
          mem: 8192
          release: "10.1"
          prepare: |
            set -e
            export PATH="/usr/sbin:/usr/bin:/usr/pkg/sbin:/usr/pkg/bin:$PATH"

            /usr/sbin/pkg_add -v pkgin || true
            pkgin -y update || true
            pkgin -y install cmake gmake bash gdb || true
            pkgin -y install clang || true
            pkgin -y install gcc12 || pkgin -y install gcc13 || pkgin -y install gcc10 || true
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 20



  NetBSD_x86_64_test_Clang_cpp23:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run in NetBSD
        id: RunInNetBSD
        uses: vmactions/netbsd-vm@v1
        with:
          usesh: true
          mem: 8192
          release: "10.1"
          prepare: |
            set -e
            export PATH="/usr/sbin:/usr/bin:/usr/pkg/sbin:/usr/pkg/bin:$PATH"

            /usr/sbin/pkg_add -v pkgin || true
            pkgin -y update || true
            pkgin -y install cmake gmake bash gdb || true
            pkgin -y install clang || true
            pkgin -y install gcc12 || pkgin -y install gcc13 || pkgin -y install gcc10 || true
          run: |
            set -e -x
            cd build/test/unix_like  
            chmod +x *.sh
            ls -l
            ./run_test_clang.sh 23
